<!DOCTYPE html>
<html lang="en">

{% load static %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeatherApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
  <div class="container-wrapper">
    <div class="black-side" style="background-color:  #00000002;">
      <h3 class="text-light text-center" style="padding-top: 20px;">Welcome to WeatherApp</h3>
      <form onsubmit="return false;" id="historyform">
        {% csrf_token %}
        <div class="search-box">
          <input type="text" name="city" id="city" class="search-input text-light" placeholder="Enetr Location..."
            style="width: 50%;" />
          <input type="date" name="date" id="date" class="search-input text-light" placeholder="Enetr Date (yyyy-MM-dd)"
            style="border-top-left-radius: 0px; border-bottom-left-radius: 0px; width: 20%;" />
          <input type="time" name="time" id="time" class="search-input text-light" placeholder="Enter Time (Optional)"
            style="border-top-left-radius: 0px; border-bottom-left-radius: 0px; width: 20%; " />
          <button type="submit" class="search-btn" onclick="searchHandel(event); " style="width: 10%;">Check</button>
        </div>
      </form>
      <h6 class="text-center text-secondary">Explore more</h6><br>
      <div>
        <div class="sidebar-list">
          <a href="{% url 'home' %}" class="item">Home</a>
          <a href="{% url 'realtime' %}" class="item">Realtime</a>
          <a href="{% url 'forecast' %}" class="item">Forecast</a>
          <a href="{% url 'history' %}" class="item text-dark" style="background-color: #20b94e;">History</a>
          <a href="{% url 'about' %}" class="item">About</a>
        </div>
      </div>
    </div>
    <div class="container-side">
      <div class="container" style="padding-top: 25%;" id="show-box">
        <div class="col-md-12 col-lg-6">
          <div class="card" style="color: #4B515D; border-radius: 35px;">
            <div class="card-body p-4">
              <div class="d-flex">
                <div class="flex-grow-1">
                  <h6 id="cityname"> </h6>
                  <p class="small" id="countryname" style="color: #868B94"> </p>
                </div>
                <h6 id="datetime"> </h6>
              </div>
              <div class="d-flex flex-column text-center mt-5 mb-4">
                <h6 class="display-4 mb-0 font-weight-bold" id="temp" style="color: #1C2331;"> </h6>
                <span class="small" style="color: #868B94" id="text"> </span>
              </div>
              <div class="d-flex align-items-center">
                <div class="flex-grow-1" style="font-size: 1rem;">
                  <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="wind_kph">
                    </span></div>
                  <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="humidity">
                    </span></div>
                  <div><i class="fas fa-sun fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="uv"> </span>
                  </div>
                </div>
                <div>
                  <img src="" width="100px" id="icon">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById("show-box").style.display = 'none'
    const searchHandel = (event) => {
      event.preventDefault();
      const city = document.getElementById("city").value;
      const date = document.getElementById("date").value;
      const time = document.getElementById("time").value;
      const csrfmiddlewaretoken = document.getElementsByName("csrfmiddlewaretoken")[0].value;

      const formData = new FormData();
      formData.append('city', city)
      formData.append('date', date)
      formData.append('time', time)
      axios.post(
        '{% url "history" %}',
        formData,
        config = { headers: { "X-CSRFToken": csrfmiddlewaretoken } }
      ).then(({ data }) => {
        console.log(data)
        document.getElementById("cityname").innerText = data.name
        document.getElementById("countryname").innerText = data.country
        document.getElementById("datetime").innerText = data.hour[0].date_time
        document.getElementById("temp").innerText = data.hour[0].temp_c + 'Â°C'
        document.getElementById("wind_kph").innerText = data.hour[0].wind_kph + 'km/h'
        document.getElementById("text").innerText = data.hour[0].text
        document.getElementById("humidity").innerText = data.hour[0].humidity
        document.getElementById("uv").innerText = data.hour[0].uv + 'uv'
        document.getElementById("icon").src = "{% static 'images/' %}" + data.hour[0].icon
        document.getElementById("show-box").style.display = ''
      })
    }
  </script>
</body>

</html>