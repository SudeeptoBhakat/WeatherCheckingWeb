<!DOCTYPE html>
<html lang="en">

{% load static %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WeatherApp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body>
  <div class="container-wrapper">
    <div class="black-side" style="background-color: #00000000;">
      <h3 class="text-light text-center" style="padding-top: 20px;">Welcome to WeatherApp</h3>
      <form method="post">
        {% csrf_token %}
        <div class="search-box" onsubmit="return false; " id="forecastFrom">
          <input type="text" id="city" name="city" class="search-input text-light" placeholder="Enetr Location..." />
          <input type="text" id="days" name="days" class="search-input text-light" placeholder="Enetr Days..."
            style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;" />
          <button type="submit" class="search-btn" onclick="handleSearch(event);">Check !</button>
        </div>
      </form>
      <h6 class="text-center text-secondary">Explore more</h6><br>
      <div>
        <div class="sidebar-list">
          <a href="{% url 'home' %}" class="item">Home</a>
          <a href="{% url 'realtime' %}" class="item">Realtime</a>
          <a href="{% url 'forecast' %}" class="item text-dark" style="background-color: #c9c126;">Forecast</a>
          <a href="{% url 'history' %}" class="item">History</a>
          <a href="{% url 'about' %}" class="item">About</a>
        </div>
      </div>
    </div>
    <div class="container-side">
      <div class="container">
        <div class="col-md-12 col-lg-6">
          <div class="card" style="color: #4B515D; border-radius: 35px;">
            <div class="card-body p-4">
              <div class="d-flex">
                <div class="flex-grow-1">
                  <h6 id="cityname"> </h6>
                  <p class="small" id="countryname" style="color: #868B94"> </p>
                </div>
                <h6 id="datetime"> </h6>
              </div>
              <div class="d-flex flex-column text-center mt-5 mb-4">
                <h6 class="display-4 mb-0 font-weight-bold" id="temp" style="color: #1C2331;"> </h6>
                <span class="small" style="color: #868B94" id="text"> </span>
              </div>
              <div class="d-flex align-items-center">
                <div class="flex-grow-1" style="font-size: 1rem;">
                  <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="wind_kph">
                    </span></div>
                  <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="humidity">
                    </span></div>
                  <div><i class="fas fa-sun fa-fw" style="color: #868B94;"></i> <span class="ms-1" id="uv"> </span>
                  </div>
                </div>
                <div>
                  <img src="" width="100px" id="icon">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="carousel-container">
        <div class="carousel-inner">
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const handleSearch = (event) => {
      event.preventDefault();
      city = document.getElementById("city").value
      days = document.getElementById("days").value
      const csrfmiddlewaretoken = document.getElementsByName("csrfmiddlewaretoken")[0].value;
      const formData = new FormData;
      formData.append('city', city)
      formData.append('days', days)
      axios.post(
        '{% url "forecast" %}',
        formData,
        config = { headers: { "X-CSRFToken": csrfmiddlewaretoken } }
      ).then(({ data }) => {
        console.log(data)
        datelist = data.days
        const container = document.getElementById('carousel-container');
        const carouselInner = document.querySelector('.carousel-inner');
        let s = ''
        datelist.forEach(element => {
          s += `<div class="container">
        <div class="col-md-12 col-lg-6">
          <div class="card" style="color: #4B515D; border-radius: 35px;">
            <div class="card-body p-4">
              <h6 class="text-center">`+ element['date'] + `</h6>
              <div class="d-flex flex-column text-center mt-5 mb-4">
                <img src="../static/images/`+ element['icon'] + `" width="100px" id="icon">
                <span class="small" style="color: #868B94">`+ element['text'] + `</span>
              </div>
              <div class="d-flex align-items-center">
                <div class="flex-grow-1" style="font-size: 1rem;">
                  <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1"><strong>Average: </strong><p>`+ element['avgTempC'] + `째C</p>
                    </span></div>
                  <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1"><strong>Min : </strong><p>`+ element['min'] + `째C</p>
                    </span></div>
                  <div><i class="fas fa-sun fa-fw" style="color: #868B94;"></i> <span class="ms-1"><strong>Average: </strong><p>`+ element['max'] + `째C</p> </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>`
        });

        carouselInner.innerHTML = s
        const firstCarouselItem = carouselInner.querySelector('.carousel-item');
        firstCarouselItem.classList.add('active');
        document.getElementById("cityname").innerText = data.name
        document.getElementById("countryname").innerText = data.country
        document.getElementById("datetime").innerText = data.localtime
        document.getElementById("temp").innerText = data.temp_c + '째C'
        document.getElementById("wind_kph").innerText = data.wind_kph + 'km/h'
        document.getElementById("text").innerText = data.text
        document.getElementById("humidity").innerText = data.humidity
        document.getElementById("uv").innerText = data.uv + 'uv'
        document.getElementById("icon").src = "{% static 'images/' %}" + data.icon
      })
    }
  </script>
</body>

</html>